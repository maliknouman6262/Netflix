<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Triguard CRM — Netflix Style</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <img src="https://images.unsplash.com/photo-1505852679233-d9fd70aff56d?q=80&w=2000&auto=format&fit=crop" alt="Roof hero"/>
      <h1>Triguard CRM</h1>
    </div>
    <div class="global-actions">
      <button id="btnAddLead" class="btn primary">+ New Lead</button>
      <button id="btnImportCsv" class="btn">Import CSV</button>
      <input type="file" id="fileCsv" accept=".csv" style="display:none" />
      <button id="btnExportCsv" class="btn">Export CSV</button>
      <button id="btnToggleKanban" class="btn">Kanban</button>
      <button id="btnToggleReports" class="btn">Reports</button>
    </div>
  </header>

  <section class="toolbar">
    <input id="q" class="input" placeholder="Search (name, city, phone, stage)…"/>
    <select id="fCity" class="input"><option value="">All Cities</option></select>
    <select id="fSource" class="input"><option value="">All Sources</option></select>
    <select id="fStage" class="input">
      <option value="">All Stages</option>
      <option>New</option>
      <option>Contacted</option>
      <option>Appointment</option>
      <option>Estimate Sent</option>
      <option>Insurance</option>
      <option>Scheduled</option>
      <option>In Progress</option>
      <option>Won</option>
      <option>Lost</option>
    </select>
    <select id="fOwner" class="input"><option value="">All Owners</option></select>
    <button id="btnClearFilters" class="btn">Clear</button>
  </section>

  <section id="kpis" class="kpis">
    <div class="kpi"><div class="kpi-label">New Leads (7d)</div><div id="kpiNewLeads" class="kpi-value">0</div></div>
    <div class="kpi"><div class="kpi-label">Appointments (7d)</div><div id="kpiAppts" class="kpi-value">0</div></div>
    <div class="kpi"><div class="kpi-label">Jobs in Progress</div><div id="kpiInProg" class="kpi-value">0</div></div>
    <div class="kpi"><div class="kpi-label">Revenue Won (MTD)</div><div id="kpiRevenue" class="kpi-value">$0</div></div>
  </section>

  <main id="app">
    <section id="homeView">
      <h2 class="row-title">AI Picks — Next Best Actions</h2>
      <div id="rowNba" class="row"></div>

      <h2 class="row-title">Leads For You</h2>
      <div id="rowLeads" class="row"></div>

      <h2 class="row-title">Jobs In Progress</h2>
      <div id="rowJobs" class="row"></div>

      <h2 class="row-title">Follow-ups</h2>
      <div id="rowFollow" class="row"></div>
    </section>

    <section id="kanbanView" class="hidden">
      <div id="kanban" class="kanban"></div>
    </section>

    <section id="reportsView" class="hidden reports">
      <div class="report-card">
        <div class="report-header">
          <h3>Revenue Trend (Last 6 Months)</h3>
        </div>
        <canvas id="chartRevenue" width="1200" height="320" aria-label="Revenue trend chart"></canvas>
      </div>

      <div class="report-grid">
        <div class="report-card">
          <div class="report-header"><h3>Pipeline Funnel (Last 90d)</h3></div>
          <canvas id="chartFunnel" width="500" height="320" aria-label="Pipeline funnel chart"></canvas>
        </div>
        <div class="report-card">
          <div class="report-header"><h3>Lead Source Mix</h3></div>
          <canvas id="chartSources" width="500" height="320" aria-label="Lead source pie chart"></canvas>
        </div>
      </div>

      <div class="report-card">
        <div class="report-header"><h3>Crew Utilization (Next 2 Weeks)</h3></div>
        <canvas id="chartCrew" width="1200" height="320" aria-label="Crew utilization bar chart"></canvas>
      </div>
    </section>
  </main>

  <!-- Lead/Job Modal -->
  <dialog id="detailModal">
    <form method="dialog" class="modal">
      <header class="modal-header">
        <h3 id="detailTitle">Lead</h3>
        <button class="btn icon" id="btnCloseModal" aria-label="Close">✕</button>
      </header>
      <div class="modal-body">
        <div class="modal-left">
          <img id="detailPhoto" class="lead-photo" alt="lead photo"/>
          <div class="field">
            <label>Name</label>
            <input id="detailName" class="input"/>
          </div>
          <div class="field grid2">
            <div>
              <label>Phone</label>
              <input id="detailPhone" class="input"/>
            </div>
            <div>
              <label>Email</label>
              <input id="detailEmail" class="input"/>
            </div>
          </div>
          <div class="field">
            <label>Address</label>
            <input id="detailAddress" class="input"/>
          </div>
          <div class="field grid2">
            <div>
              <label>City</label>
              <input id="detailCity" class="input"/>
            </div>
            <div>
              <label>Source</label>
              <input id="detailSource" class="input"/>
            </div>
          </div>
          <div class="field grid2">
            <div>
              <label>Stage</label>
              <select id="detailStage" class="input">
                <option>New</option><option>Contacted</option><option>Appointment</option>
                <option>Estimate Sent</option><option>Insurance</option>
                <option>Scheduled</option><option>In Progress</option><option>Won</option><option>Lost</option>
              </select>
            </div>
            <div>
              <label>Owner</label>
              <input id="detailOwner" class="input"/>
            </div>
          </div>
          <div class="field grid2">
            <div>
              <label>Est. Value ($)</label>
              <input id="detailValue" type="number" class="input"/>
            </div>
            <div>
              <label>Score</label>
              <input id="detailScore" type="number" min="0" max="100" class="input"/>
            </div>
          </div>
        </div>
        <div class="modal-right">
          <div class="actions">
            <button id="btnCall" type="button" class="btn primary">Call</button>
            <button id="btnText" type="button" class="btn">Text</button>
            <button id="btnEmail" type="button" class="btn">Email</button>
            <button id="btnFinance" type="button" class="btn">Send 0% Promo</button>
          </div>
          <div class="field">
            <label>Notes</label>
            <textarea id="detailNotes" class="input" rows="8" placeholder="Add a note…"></textarea>
          </div>
          <div class="ai-templates">
            <div class="ai-title">AI Templates</div>
            <button data-tpl="call" class="btn small">Call Script</button>
            <button data-tpl="adjuster" class="btn small">Adjuster Scheduling SMS</button>
            <button data-tpl="promo" class="btn small">0% Promo SMS</button>
          </div>
          <div class="audit" id="auditLog"></div>
        </div>
      </div>
      <footer class="modal-footer">
        <button id="btnDelete" class="btn danger" type="button">Delete</button>
        <div class="spacer"></div>
        <button id="btnSave" class="btn primary">Save</button>
      </footer>
    </form>
  </dialog>

  <template id="cardTemplate">
    <article class="card">
      <img class="card-img" alt="lead image"/>
      <div class="card-content">
        <div class="card-title"></div>
        <div class="card-sub"></div>
        <div class="pill-row">
          <span class="pill pill-stage"></span>
          <span class="pill pill-score"></span>
          <span class="pill pill-value"></span>
        </div>
      </div>
    </article>
  </template>

  <script src="app.js"></script>
</body>
</html>
